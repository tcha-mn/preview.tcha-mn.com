---
import { DateTime } from 'luxon';

import type { Semester } from '~/queries/SemesterWithClasses';

export interface Props {
  semester: Semester;
}
const { semester } = Astro.props;

const now = DateTime.now();

const registrationOpenFuture = semester.registration_open > now;
const registrationOpen = semester.registration_open < now && semester.dates.start > now;
const registrationPast = semester.dates.start < now;
let registrationStatus = registrationOpen ? 'open!' : 'closed.';
if (semester.early_registration_end > now) {
  registrationStatus += ` (Early registration discounts are available until ${semester.early_registration_end.toLocaleString(
    DateTime.DATE_FULL
  )})`;
}
---

<h2 class="font-bold leading-tighter tracking-tighter font-heading text-heading text-3xl md:text-4xl mb-12">
  {semester.name} Semester
</h2>

{
  registrationOpen && (
    <div
      class="p-4 mb-4 text-sm text-green-800 rounded-lg bg-green-50 dark:bg-gray-800 dark:text-green-400"
      role="alert"
    >
      <span class="font-medium">Registration is open!</span>.
    </div>
  )
}
{
  registrationOpenFuture && (
    <div class="p-4 mb-4 text-sm text-blue-800 rounded-lg bg-blue-50 dark:bg-gray-800 dark:text-blue-400" role="alert">
      <span class="font-medium">
        Registration will open on {semester.registration_open.toLocaleString(DateTime.DATE_FULL)}
      </span>
    </div>
  )
}
{
  registrationPast && (
    <div class="p-4 mb-4 text-sm text-blue-800 rounded-lg bg-blue-50 dark:bg-gray-800 dark:text-blue-400" role="alert">
      <span class="font-medium">
        Registration is no longer open. Please check back later for any upcoming semesters.
      </span>
    </div>
  )
}

<p class="text-l mb-6">
  Classes for this semester (unless otherwise noted) are held at <a
    class="text-blue-600 underline dark:text-blue-500 hover:no-underline"
    target="_blank"
    href="https://maps.google.com/?q=12600 Johnny Cake Ridge Rd, Apple Valley, MN 55124">South Suburban Church</a
  > in Apple Valley on {semester.dates.day_of_week}s from {semester.dates.start.toLocaleString(DateTime.DATE_MED)} to {
    semester.dates.end.toLocaleString(DateTime.DATE_MED)
  }{
    semester.dates.breaks.length > 0 &&
      ` with the exception of the following dates: ${semester.dates.breaks.map((d) => d.toLocaleString(DateTime.DATE_MED)).join('; ')}`
  }.
</p>
